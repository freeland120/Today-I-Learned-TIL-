## Unix/Linux 기본학습/p32~35

**1)파일 시스템이란 무엇인가?** 

물리적인 저장장치에 파일을 생성,저장,관리하기 위한 **논리적인 자료구조**를 파일 시스템이라 한다.

물리적인 디스크는 논리적인 파티션으로 나누어지며, 각 파티션별로 고유한 파일 시스템을 생성한다.

(ex. NTFS, EXT2, EXT3, EXT4)



FAT32, NTFS : 윈도우 파일 시스템

EXT2, EXT3, EXT4 : 유닉스/리눅스 시스템



1.물리적인 디스크를 하나 샀어

2.제일 먼저 파티션을 생성(하드 디스크 통으로 쓰는게 아니라 효율적으로 쓰려면 논리적으로 나눠야 할거 아냐) : fdisk

3.파일시스템 생성 : mkfs 계열 명령어들 사용

4.유닉스나 리눅스 시스템에 마운트 작업해야 한다.(mount:특정 디렉토리를 만들어서 해당 파일 시스템과 연결 시키는 것을 의미한다) 그래서 사용자 입장에서는 그 파일 시스템이 특정 디렉토리로 보이는 것

특정 디렉토리로 파일 시스템을 연결하는 것 : mount

파일 시스템 연결 해지하는 것 : umount



파일 시스템이 생성이 되면 그 구성 요소를 알아놔야 한다!!! 각 블록이 의미하는걸 알아야 함

Boot block(부트블록) : 말 그대로 부트를 담당하는 블록, 시스템을 부팅하거나 초기화 하기 위한 블록(부트스트랩 코드를 담고 있다.)

Super block(슈퍼블록) : 해당 파일 시스템 전체를 관리하기 위한 블록 

**i-node list(아이노드 리스트)** : 파일 시스템의 목적은 파일을 생성&저장&관리 하기 위한 시스템임 그러면 그 관리를 위한 정보를 포함하고 있는게 있어야겠지? 그게 바로 **아이노드 리스트**

**해당 파일 시스템에 저장돼 있는 파일에 대한 속성정보를 관리하기 위한 블록이다**

아이노드 리스트 블록에 담겨있는 속성정보는 다 외우는게 좋다!!!!! 꼭 외우자!!! 실무적으로도 많이 보게 된다.

- i-node number : 우리야 파일명으로 파일을 식별하지만 OS는 당연히 식별자id가 있어야겠지? => 해당 파일시스템 내에서 해당 파일을 식별하기 위한 고유한 식별자를 **i-node number**라고 한다. 
- 파일타입 : 일반파일, 디렉토리, 장치파일 등 파일 유형 => 파일 타입에 대한 정보
- 접근권한 : 파일에 대한 접근 권한
- link count : 얼마나 많은 파일이 이 i-node 구조체를 참조하고 있느냐라는 말임(**하드링크 카운트**)
- 소유자 : 파일의 소유자/UID
- 소유그룹 : 파일의 소유그룹/GID
- 파일 크기 : 파일 크기
- **MAC Time** : 시험에 아주 자주 나오는 단골 용어!!! 왜??? 파일에 대한 무결성 때문에!!! 어떤 사고가 발생했을 때 누군가 이 파일을 변조했냐? 안했냐? 쉘 프로그램을 악성 프로그램으로 바꿨냐? 이런걸 하기 위해서는 MAC Time 체크를 해야한다. **언제 파일의 내용이 변경이 됬는지? 언제 마지막으로 접근했는지? 언제 마지막으로 파일의 속성을 바꿨는지?** 

1) last Modification Time : 파일의 내용을 마지막으로 수정한 시간

2) last Access Time : 파일을 마지막으로 접근한 시간 (파일을 읽든 쓰든 어떻게든 접근한거임)

3) last Change Time : 파일의 속성을 마지막으로 변경한 시간 (Create 아니다!!!)

속성이 뭐다고??? 저 위에 있는 것들!!! i-node number, 파일타입, 접근권한, 소유자 등

MAC Time은 시험에 자주 나와~ "침해 사고 발생 시 무결성 체크를 하기 위해서 확인해야 하는 것은?"

- Block index : Data blocks에 저장되어 있는 파일 내용에 대한 색인 정보 

실제로 우리가 i-node list를 보고 있는데 파일 시스템의 마지막 블록이 Data block이다. Data block은 실제 파일이 저장되어 있는 영역이라고 보면 되는데 data block 곳곳에 저장되어 있을꺼 아냐? 그래서 이 파일에 대한 데이터가 어디 저장되어 있는지 index정보를 담고 있는걸 Block index라고 한다.



파일들에 대한 속성정보를 담고 있는 i-node 구조체 리스트로 이루어져 있다.

구조체 : 스트럭쳐 자료구조 를 의미

각 파일의 속성정보는 위와 같다. 주의할 점은 i-node에는 파일명이 없다(사용자 입장에서나 파일명이 필요하지 컴퓨터 입장에서는 i-node number라는 고유한 id식별자로 구분하니까~)

그럼 우리가 보는 파일명은 어디있을까? **디렉토리**에 있다.

디렉토리는 "특수한 파일"이다. 이 디렉토리에는 **파일명, i-node number**를 가지고 있다.



유닉스/리눅스 시스템에서는 디렉토리라고 표현을 하고 윈도우에서는 폴더라는 표현을 쓴다.



정리해보자. **디렉토리는 안에는 파일명과 파일 명에 해당하는 i-node number 맵핑 정보 목록을 가지고 있는 특수한 파일이다**

![image-20200317212310947](C:\Users\KAUstar\AppData\Roaming\Typora\typora-user-images\image-20200317212310947.png)



그래서 i-node list 상에는 파일명이 없다!!!



### 침해 사고가 발생하게 되면 피해 시스템 파일에 대한 무결성 확인을 위한 타임라인 분석을 수행한다. 이 때 파일 시스템 i-node 구조체의 MAC Time을 점검한다.



특정 파일의 i-node에 대한 속성정보는 stat(Linux) 명령을 통해 확인할 수 있다.

stat 0jes 쳐서 나오는 것들을 봐보면

Inode라고 되어있는 부분은 **전체 파일 시스템이 아니라 해당 파일 시스템 내에서 파일을 식별하기 위한 식별자다**



Data blocks : 실제 파일의 내용(데이터)이 저장되는 블록,고정 크기 block들로 이루우져 있다.





**2) 파일 시스템과 링크 파일(꽤 중요)**

이걸 제대로 구분하는 사람이 적다! 알아두면 좋겠지?

하드링크와 실볼릭 링크 구분할 수 있어야 한다.  

구조를 이해해보자

링크는 그냥 윈도우의 바로가기 아이콘이랑 비슷한 개념이라고 보면 된다.

원본 파일을 참조할 수 있는 또 다른파일을 만드는걸 링크라고 한다.

링크에는 하드 링크(Hard link) , 심볼릭 링크(Symbolic link)로 구분할 수 있다.

하드 링크는 유닉스 초창기에 나왔고 그 다음에 나온게 심볼릭 링크



**입력문법**

링크파일을 만들때는 ln이라는 명령어를 쓴다.

ln	source	target  : 원본 파일(source)에 대해서 타겟 링크 파일(target)을 만들겠다.(원본을 참조하는 타겟 링크 파일을 만들겠다.) <= 이렇게 만들면 하드링크를 만들겠다는 것



ln	-s	source	target <= 심볼릭 링크 만들겠다.





#### 하드링크

하드링크는 타겟 링크 파일을 만드는데 원본 파일과 같은 i-node number를 가진 파일을 만듬

그니까 디렉토리 상에 새로운 파일명이 생기고 동일한 i-node number를 가리키는 파일이 생성이 됨

다시 말해, 하드링크는 동일한 i-node number를 가지고 있는 파일이다.



1) 하드 링크는 유닉스 초창기부터 지원하던 방식으로 기존파일과 동일한 i-node number를 가지는 파일을 생성하여 접근하는 방식을 말한다.

2) i-node number는 파일시스템별로 고유한 값이기 때문에 동일 파일시스템 내에서만 하드 링크가 가능하고 디렉토리는 하드 링크가 불가능 하다.(그런데 커널이 관리 목적으로 걸때는 디렉토리도 하드링크가 걸려있다. 하지만 사용자가 하드링크를 걸 수는 없다. )

3) 하드 링크 파일을 생성하면 해당 i-node의 링크 카운트(하드링크 카운트)가 +1 된다. 파일 삭제 시에는 링크 카운트를 -1 시킨 후 그 값이 0이 되었을 때 해당 파일의 i-node 정보 및 데이터를 삭제한다. i-node를 참조하는 파일이 있으면 삭제하지 않는다.



touch라는 명령어는 해당 파일이 존재하지 않으면 크기가 0인 파일을 생성해준 다.(빈파일)

그런데 만약 기존에 파일이 존재한다면 그 파일의 MAC Time 을 변경할 수 있다.

touch --help를 쳐봐 여러가지 옵션이 나온다.

touch -a

touch -m

touch -t : 현재 시간으로 변경해거나 특정 시간으로 변경도 해준다.



실습 한번 진행해 보자

1) touch a.dat : touch 명령어로 a.dat 파일 생성

2) stat a.dat : 파일의 속성 정보를 볼 수 있다.

속성 정보는 뭡니까? 해당 파일의 i-node 구조체 정보

Links : 1 이다라는 것은 뭐? 하드 링크 카운터가 1이다라는 의미 , 이 i-node 구조체를 참조하는 파일은 1개밖에 없다.

3) ln	a.dat	a_hln.dat

ls -il : i-node number를 볼 수 있는 옵션

4) rm -rf a.dat : a.dat 파일 삭제





#### 심볼릭 링크

심볼릭은 파일 시스템 상관없이 링크 할 수 있다.

심볼릭 링크는 만들게 되면 별도의 파일을 만들게 된다.

파일 자체를 만들어서 새로운 i-node 구조체를 생성한다.

그리고 그 구조체를 참조하는 i-node number를 가지게 된다.



자 정리해보자!

**심볼링 링크는 원본 파일에 대한 경로정보/링크 정보를 담고 있는 또다른 파일**

그러므로, 심볼릭 링크는 동일한 i-node number를 가지고 참조하는 방식이 아니기 때문에 **서로 다른 파일 시스템간의 링크가 가능하다** 왜요? 서로 다른 파일 시스템이기 때문에!!! 디렉토리 심볼릭 링크도 가능하다.



심볼릭 링크 실습을 해보자!

rm -rf a* : a로 시작하는 모든 파일을 지운다는 거겠지?

'*' : 이건 뭐야? aesterisk 임의의  문자열을 가리키는 와일드 카드(문자열이 없거나 0이거나)



touch b.dat

ln -s b_sln.dat

rm -rf b.dat

cat b_sln.dat : 파일이 없거나 그런 디렉토리가 없다고 뜸 링크가 깨졌다는 것임