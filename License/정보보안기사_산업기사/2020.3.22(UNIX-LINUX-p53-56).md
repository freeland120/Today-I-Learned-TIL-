## 유닉스/리눅스 9강(p53~56)

#### 유닉스/리눅스 시스템 관리(이부분은 출제비중이 낮기때문에 편히봐도 됌)



**(1) 시스템 시작과 종료**



init 프로세스 배운거 딱 생각나야할 것 3가지

1.pid =1

2.시스템 운영환경 초기화 => 초기 프로세스 기동

3.대리모 프로세스 역할



런레벨 정보가 어딨다고?

cat /etc/inittab(이닡 탭이라는 파일에 있다.)



runlevel이라는 명령어도 있다.



유닉스 기본 Run Level은 3이다.

 Xwindow 모드로 쓰기위해서 5로 쓰기도 한다. => 리눅스





### 시스템관리 파트에서 중요하게 봐야할 껀 "사용자 관리"이다.

1) 사용자 계정 추가(useradd)

2) 사용자 계정 변경(usermod)

3) 사용자 계정 삭제(userdel)

4) 그룹 추가(groupadd)

5) 그룹 변경(groupmod)

6) 그룹 삭제(groupdel)



주요 옵션 단답형으로 출제할 수도 있겠지?

-u 유저ID : 사용자 UID를 지정한다.

**-g 그룹명 또는 그룹ID : 사용자의 기본그룹을 설정한다.**

**-G 그룹명 또는 그룹ID : 사용자의 보조그룹을 설정한다.**



옵션 살펴보고~



/etc/login.defs(파일)





쉘에서 이거 한 번 쳐보고 이해해봐

vi /etc/default/useradd

vi /etc/login.defs



cd /etc/skel

ls -al



그룹정보 별로 안중요하다네?



//////////////////////////////////////////////////////////



**런레벨이라는 것은 시스템 운영 모드를 말한다**

다양한 런레벨이 존재한다.

너무 외우는 것에 집착ㄴㄴ



init 프로세스

1.pid =1 

2.시스템 운영 환경 초기화 작업



init 프로세스가 어디있다고?

cat /etc/inittab 이라는 곳에 런레벨이 정의되어 있다!!!



일단 페도라/데비안 등 배포판에 따라서 조금씩은 다른것 같다?  ㅇㅋ?

초기스크립트는 어디있지?

맨 먼저 루트 디렉터리로 간 후에 이동 합시다?

cd /

cd /etc/rc5.d 에 들어가면 초기 스크립트 파일을 볼 수 있다.

ls -a

**스크립트 파일 보는 방법**

크게 K로 시작하는 것과 S로 시작하는게 있다.

K는 kill에 의미이고

S는 start에 의미이다.



일단 런레벨을 기동을할 때 S로 시작하는 스크립트 파일이 먼저 기동이 되고 K로 시작하는 스크립트 파일은 기동이 되지 않는다.

우선순위가 낮을 수록 먼저 실행한다. 15는 16보다 빠르게 



그런데 우리가 부팅시에 지금 S로 되있는 스크립트 파일을 실행 안시켜주고 싶어?

그러면 어떻게 해야겠어?

당연히 S로 시작하는 스크립트 파일을 K로 바꿔주던가 해야겠지?

mv S56xineted K56xineted

그리고 여기 나와있는 스크립트 파일들은 '심볼릭 링크'파일들이다.

왜 그러겠어? 당연히 다양한 런레벨들이 있기때문에 전부 복사하기 어려우니까 타고타고 들어가자

원본을 두고 전부 링크로 만들어 놓으면 편하기 때문에



실제 실행 스크립트는 cd /etc/init.d 에 들어간 후에 ls -al

cat ssh



### 여기서 집고 넘어가야 할 것

런레벨을 다 외울 필요는 없지만 유닉스/리눅스 런레벨의 살짝 차이정도는 알고 있어야 한다.

유닉스에서는 런레벨 5가 시스템 power off 모드 이지만

리눅스에서는 런레벨 5가 X윈도우 환경을 실행된 멀티유저 실행모드이다.



유닉스는 그래서 디폴트로 런레벨 3인 멀티유저 모드로 들어간다.



그래서 다시 말해보면?

유닉스에서 런레벨 3가 '멀티유저 모드'

리눅스에서는 런레벨 5가 'X윈도우 멀티유저 모드'



런레벨 0은 뭘까?

바로 PROM(Programmable Read-Only-Memory)모드 이다.

PROM모드는 '시스템 부팅 전 하드웨어를 체크하는 것  '



init "O" 이렇게 명렁어로 런레벨을 시작해줄수도 있다.





System V와 BSD 명령어 다 외울 필요 없다.



하드디스크 동기화(sync)

우리가 파일을 생성했을 때 바로 하드디스크에 저장이 되는게 아니다. 

하드디스크의 입/출력에 대한 효율성을 높이기 위해 버퍼를 운영한다.

이때 시스템이 비정상적으로 종료가 됬을때 내가 생성한 파일이 저장소에 동기화가 되지 않을 수 있기 때문에 sync라는 명령을 내리게 된다.(파일 시스템에서 무결성 문제를 방지하기 위해서)



## 시스템관리 파트에서 가장 중요하게 챙겨봐야할 "사용자 관리" 파트

1)사용자 계정 추가(useradd)

사용자 관리에서 챙겨둬야할 명령어 3가지

1.useradd(사용자 추가)

2.usermod(사용자 변경)

3.userdel(사용자 삭제)



그룹도 똑같다

1.groupadd

2.groupmod

3.groupdel



**주요 옵션**

1) -u 유저ID

사용자 UID를 지정한다.



2) -g 그룹명 또는 그룹ID

사용자의 기본그룹(primary group)을 설정한다.



3)-G 그룹명 또는 그룹ID

사용자의 보조그룹을 설정한다.

ex) useradd -G 500,501,502 kiwi99



4)-c comment

계정에 대한 설명으로 일반적으로 사용자의 full name을 등록한다.



5)-d home_dir

계정의 홈디렉토리를 설정한다.



6)-s shell

계정의 로그인 쉘을 지정한다.



6번까지 보면 /etc/passwd 파일에 나와있는 정보를 다룬다는 것을 알 수 있겠지?

사용자명:패스워드:UID:GID:comment:홈디렉터리:로그인쉘

7개의 필드로 돼있다는 것을 알 수 있겠지?

<hr>

7)-e expire_date

계정 만료일을 지정한다. 만약"빈 문자열을 지정하면 이는 기간이 없음"을 의미한다.



8)-f inactive

계정 비활성화 일수를 지정한다. "-1" 지정시 비활성화 기간을 설정하지 않는다.



9)-p password

생성하는 계정의 패스워드를 지정한다. 

**주의) 이렇게 패스워드를 지정하면 shadow 파일에 평문으로 저장이 됌 따라서 별도의 암호화를 수행해야 한다. 그래서 이 옵션을 잘 이용하지 않고 계정을 생성했으면 passwd 명령어를 통해 패스워드를 암호화해서 설정하게 된다.**



passwd 명령어 통해서 암호화 하는걸 기본으로 한다잉~



**계정 생성시 참조하는 기본설정 정보**

기본적으로 useradd YDG 하면 밑에 3개가 디폴트로 생성이 된다.

1. /etc/login.defs(파일)
2.  /etc/default/useradd(파일)
3.  /etc/skel(디렉터리)   <= 리눅스 얘기



useradd -g channel -G dev,dba -c "YDG" -f 7 -e 2020-03-29 kiwi05

위와 같이 -u로 UID를 따로 설정하지 않으면 시스템이 기본으로 설정해준다. 

리눅스 같은 경우는 일반사용자 계정을 500이상으로 부여한다.(참고로 알아두기)



터미널에서 vi /etc/default/useradd 를 쳐서 들어가면 시스템 기본 설정을 볼 수 있다.



다양한 패스워드 정책 설정관리를 볼 수 있는 명령어는 : vi /etc/login.defs



cd /etc/skel로 들어가보자

이걸 보면 처음 계정을 생성하게 되면 이 skel 밑에있는 아래와 같은 환경설정 파일들을 기본으로 홈디렉터리로  복사해서 가져오게 된다. 

![image-20200330001228208](C:\Users\KAUstar\AppData\Roaming\Typora\typora-user-images\image-20200330001228208.png)



암호화된 패스워드 정보가 담기는 파일은 /etc/shadow 인데 

:!!:     <= 패스워드가 잠겼다라는 의미 

  #### 옵션 주의깊게 잘 봐두기 시험에 낼 수 있음



<hr>

### usermod : 사용자 계정 정보를 '변경'하기 위한 명령어

![image-20200330002142561](C:\Users\KAUstar\AppData\Roaming\Typora\typora-user-images\image-20200330002142561.png)



<hr>

### userdel : 사용자 계정 정보를 '삭제'하기 위한 명령어



ls -al ~kiwi05 

'~' 물결기호는 홈 디렉터리를 의미한다. 그러니까 위의 명령어 '~kiwi05'는 kiwi05의 홈 디렉터리를 의미한다.

![image-20200330002500240](C:\Users\KAUstar\AppData\Roaming\Typora\typora-user-images\image-20200330002500240.png)





![image-20200330002604063](C:\Users\KAUstar\AppData\Roaming\Typora\typora-user-images\image-20200330002604063.png)

사용자 계정을 삭제하고 싶을 때 userdel kiwi05이렇게 한다면 삭제가 되긴하는데

전부 삭제되는건 아니다. '홈 디렉터리'와 '사용자 메일함'은 남아있게 된다.

그래서 전부 삭제하려면 userdel -r kiwi05 이렇게 쳐야 한다.



'id'명령어를 통해서 해당 계정이 존재하는지 찾아 볼 수 있음





### 4. 로그인 불가 계정 설정

이것도 중요하다!!! 시스템 계정, 어플리케이션 계정 등 로그인이 불필요한 계정의 경우 로그인이 불가능하도록 설정하는 것이 보안상 안전하다.

**/etc/passwd 파일에서 해당 계정의 7번째 필드인 로그인쉘을 '/sbin/nologin' 또는 '/bin/false'로 설정해줘야 한다.**



물론 shadow파일을 이용해서 로그인 불가로 만들어 줄 수도 있음 

 ![image-20200330003226923](C:\Users\KAUstar\AppData\Roaming\Typora\typora-user-images\image-20200330003226923.png)

원격에서 터미널 접속을 하려고 하니 연결이 안돼지? 왜냐 로그인 쉘이 /sbin/nologin 으로 설정 되어 있기 때문에~



그 다음에 나오는 내용들은 한번 쭉 봐보기

그룹 정보쪽은 별로 안중요하다고 하네?