## 시큐어 코딩 블록체인 개발C반(도커 수업정리)

https://docs.google.com/document/d/17vpwDiekZ3Kv31o4p4yuvqqqKPmxYFbzI7Ea4ezo7O0/edit?ts=5e001f6d#



# 도커란 무엇인가?

복잡한 리눅스 어플리케이션을 컨테이너로 묶어서 실행할 수 있음!
기존에 내가 서버를 구축하기 위해 깔고 환경설정하고 그런걸 할 필요가 없이
그냥 가져와서 깔기만 하면 됨
개발,테스트 환경을 효율적으로 사용할 수 있게 됨
컨테이너를 전 세계 사람들과 공유



# 가상머신과 도커

이미지 안에 OS가 포함되기 때문에 이미지 용량이 커짐! -> 네트워크로 가상화 이미지를 주고 받는건 꽤 부담스럽게 됨
가상 머신의 성능 문제가 잇다 보니 리눅스 컨테이너가 나옴!
하드웨어를 효율적으로 쓰기 위해 만들어진 가상화 기술이 여러 한계점에 부딪혀서 '도커' 기술이 나오게 되었다.
도커의 특징-도커는 게스트 os를 설치하지 않음

-이미지에 서버 운영을 위한 프로그램과 라이브러리만 격리해서 설치-이미지 용량이 크게 줄어듦

-호스트와 OS 자원(시스템콜)을 공유
가상화 기능의 장점 단점

내 피씨의 하드웨어 자원을 100퍼센트 활용가능but,불필요한 리소스 낭비,성능 저하-네트워크 배포등의 단점 등을 도커의 이용으로 단점을 커버 할 수 있게 됬다

호스트 pc에 우분투를 깔고 그 우분투 안에 도커 버전을 설치하고 우분투를 실행시켜 봤는데 호스트에서 우분트를 실행한 것과 별반 차이가 없다.
도커는 하드웨어 가상화 계층이 없음!
도커는 이미지 생성과 배포에 특화 되어있다. 도커는 가상화의 단점을 커버하기 위해 나온것이고 단점중에 배포의 어려움이 있기 때문에 그걸 극복
다양한 API를 제공하여 원하는 만큼 자동화 가능 -> 개발과 서버 운영에 매우 유용!
CI/CD : 지속적인 통합/ 지속적인 배포
도커 이미지와 컨테이너는 뭐가 다른거지???
이미지는 서비스 운영에 필요한 서버 프로그램, 소스 코드, 컴파일된 실행 파일을 묶은 형태
붕어빵 틀에 해당되는게 '이미지'가 되는 것이고
저장소(도커허브)에 올리고 받는건 '이미지' : 이 때 쓰는 명령어는 push/pull
컨테이너는 이미지를 실행한 상태
가상화에서의 이미지의 개념은 각각 이미지 파일로
하나의 이미지를 다운받으면 내가 여러개의 컨테이너를 실행해 볼 수 있음
운영체제로 치면 이미지는 실행파일이고 컨테이너는 프로세스
서비스와 데몬의 차이점이 뭘까?
도커의 이미지는 바뀐 부분을 어떻게 관리하나? 유니온 파일 시스템 형식으로 관리한다.
도커에서 이미지는 파일들의 묶음이고 내가 여러개의 이미지를 실행시켜야 하는 환경이라면 유니온 파일 시스템 형식으로 중복되는걸 최소화 시킬 수 있게끔 자원의 낭비가발생하지 않도록 만들어준다.



# 이제 서버 세팅과 재포는 어떻게?

Immutable Infrastructure : 한 번 설정한 운영 환경은 변경하지 않는다(immutable)라는 개념

##### 장점

편리한관리,확장,테스트,가볍다



고래는 서버에서 여러개의 컨테이너를 실행하고 이미지 저장과 배포를 의미



### 도커 요약

도커는 서비스 운영 환경을 묶어서 손쉽게 배포하고 실행하는 경량 컨테이너화 기술

도커설치 시

윈도우 10 프로에서 운용하고 싶다면 도커&도커 툴박스까지 깔아줘야함



////////////////////////////////////////////////////////////

리눅스에서 백슬래쉬를 쓰는 이유는 스페이스를 쓰기 위해서



VM 머신 안에서 Host의 파일을 불러오기 위해서는 FTP를 써도 되지만

Drag&Drop으로 편하게 할 수 있다.





IP를 나눠쓰는 환경인 NAT처럼 이러한 환경에서 외부환경에서 내부 네트워크환경을 사용할 수 있게 연결해주는것을 포트포워딩이라고 한다.

NAT와 NAT Network는 조금 다르다

NAT는 호스트 피씨를 게이트웨이 삼고 내부 가상 머신들간의 통신이 불가능하지만

NAT Network는 내부 가상 머신들간의 통신도 가능하다.



포트포워딩이란!!!

외부 네트워크는 내 호스트 피씨의 IP밖에 모르기 때문에 내 호스트 pc 내부의 가상 머신에 접근 하고 싶을 때 쓰는 기술이 포트포워딩이다. 그래서 내 외부 네트워크에서 내 호스트 pc로 들어오면 내 호스트 피시가 포트번호를 통해서 접속이 가능할 수 있게 해준다. 그걸 해주기 위해서 NAT 네트워크 추가 설정에 들어가서 포트를 설정



외부 네트워크가 내가 설정한 1234포트번호로 들어오면 내 호스트피씨가 1234에 해당하는 가상 머신 네트워크로 들어가기 위해 80번포트로 들어가게된다.







## 도커 설치

**참고자료**[**http://www.pyrasis.com/docker.html**](http://www.pyrasis.com/docker.html)


**우분투 VMware 이미지 다운로드** https://cafe.naver.com/thisislinux/2499 에서 Server 압축 실행 파일 다운로드 후 압축 해제C:\Ubuntu\Server\Server.vmx 파일 실행ubuntu / ubuntu 계정으로 로그인

https://news.sbs.co.kr/news/endPage.do?news_id=N1005573011
**VMware Tools 설치** #1 VM 메뉴 > Install VMware Tools 클릭



**VMware Tools 설치** #1 VM 메뉴 > Install VMware Tools 클릭

![image-20191223145838021](C:\Users\^^\AppData\Roaming\Typora\typora-user-images\image-20191223145838021.png)

![image-20191223150024912](C:\Users\^^\AppData\Roaming\Typora\typora-user-images\image-20191223150024912.png)



curl 은 웹서버의 자원을 가져오는 명령어



![image-20191223150831096](C:\Users\^^\AppData\Roaming\Typora\typora-user-images\image-20191223150831096.png)

![image-20191223150857733](C:\Users\^^\AppData\Roaming\Typora\typora-user-images\image-20191223150857733.png)

**도커 이미지 생성** 

#1 작업 디렉터리 및 main.go 파일 생성

root@server:~# cd ~

root@server:~# mkdir docker

root@server:~# cd docker

root@server:~/docker# gedit main.go

![image-20191223151402062](C:\Users\^^\AppData\Roaming\Typora\typora-user-images\image-20191223151402062.png)



docker container run -p 9000:8080 example/echo:latest 

-p 가 포트포워딩 옵션임



docker container ps

docker container stop c9(c9은 컨테이너 id 일부)



앞으로 작업하다보면 내가 도커에서 컨테이너 안에서 컨테이너를 띄울 수 있고 그렇게 되는데

내가 다단계 작업을 하고 있을 때 그것을 식별할 수 있어야 한다는 것이다.

내가 호스트안에서 하고 있는것인지 컨테이너 안에서 하고 있는것인지

root@server:~/docker#

root@8f891624939:/go#

구분할 수 있어야 한다.



docker container ps -a : 컨테이너 생성된 목록 보여주는 명령어



it는 내가 입력을 받아들이겠다는 것이고

d라는 것은 백그라운드로 서비스를 돌리겠다

docker container ls --filter "ancestor="example/echo"

docker container stop $(docker container ls -q) : 실행중인 컨테이너를 모두 중지



리파지토리/이미지명:태그명

