## 하이퍼레저 정리내용(2020.4.1)

X.500 인증서를 발급하는 일반적인 스트럭쳐를 PKI라고 한다.

하이퍼레저는 X.500기반의 멤버십 관리 서비스(MSP)를 제공한다.

공인인증서 발급하는 메커니즘이랑 비슷하다.(국가에서 지정한 기관만이 인증서를 발급할 수 있잖아?)

인증서기반의 허가형 블록체인 = 하이퍼레전



1.허가형 블록체인

- 멤버십 관리 서비스를 통해 허가된 참여자만 접근을 허용

- 참여자의 블록체인 접근 권한을 제어 가능
- 참여자 행위에 대한 책임성을 물을 수 있다.
- POW를 사용하는 대신 다른 효율적인 알고리즘을 상황에 맞게 바꿔줄 수 있는 모듈형임(기본적으로 투표기반)
- 높은 거래 완료성



**체인코드(chaincode) : 하이퍼레저 패브릭의 스마트 컨트랙트**

이더리움 : 모든 피어의 블록체인에서 실행된 스마트 컨트랙트 계약의 결과가 항상 동일한 것을 보장하기 위해 결정적(deterministic) 프로그래밍 언어를 특별히 개발하여 사용(Solidity)

하이퍼레저 패브릭 : Go, Java 등 일반적인 프로그래밍 언어 사용



3.내부 가상통화 부재

- 내부 가상 통화가 필요한 이유 : 거래 수수료 지불, Dos 공격 방지

인센티브가 필요한 이유는 블록체인 네트워크 상의 많은 노드를 확보하기 위해서지

근데 하이퍼레저는 적은 노드들끼리 합의를 통해서 운영하면 되기 때문에 인센티브가 필요없지



**비작업 증명 방식의 합의 : 수수료 불필요**

**지정된 보증 피어(endorsing peer)만 체인 코드 실행**

**Dos공격은 해당 보증 피어들에만 영향**

**보증피어가 내부 정책을 통해 체인코드 실행 포기 시점 결정 가능 => 무한한 체인코드 실행 방지 기능**



내부에 가상통화가 없지만 수수료를 지불하지 않고도 시스템이 돌아가는 구조이다.



4.높은 성능

- 서로 다른 보증 피어들을 통해 체인코드를 실행하는 다수의 거래들을 동시 처리 가능 => 높은 성능
- 정보 이름에 해당하는 키의 버번 관리를 통해 동시 처리에 따른 비결정적 실행

만약에 블록체인에 담겨있는 정보를 C1이라는 체인코드와 C2라는 체인코드에서 parallel하게 access를 할 수 있게 만든다면... 실행하는 순서에 따라서 access하는 정보가 달라지기 때문에 결과에 영향을 끼칠 수 있다.



어떤 블록체인에 대한 동일한 정보를 각 체인코드들이 동시에 접근하게 된다면 변경하거나 그럴 수 있잖아?

그러면 deterministic하지 못하게 될 수 있다.

같은 데이터를 접근하는 순서에 따라서 결과가 달라질 수 있다!!! 그걸 하이퍼레저는 "키의 버전관리"를 통해 문제를 해결했음



5.교체 가능한 모듈 구조

- 하이퍼레저 패브릭은 전체 시스템을 모듈 구조로 설계하고, 합의 알고리즘 등 응용에 따라 요구사항에 차이가 큰 모듈을 필요에 따라 교체 가능하게끔 만들었다.(기존의 퍼블릭 블록체인은 합의 알고리즘을 교체할 수 없었기 때문에 하드포크가 발생했던 것임)

- 합의 프로토콜 : SOLO, Kafaka, PBFT 등

  

6.멀티 블록체인 지원

- 전체 시스템의 다수의 채널로 구분
- 채널별로 별도의 독립적인 블록체인 유지 가능
- 참여자는 특정 채널에 가입함으로써 공유할 블록체인을 선택할 수 있고, 다수의 채널에 가입 가능

![image-20200418200843632](C:\Users\KAUstar\AppData\Roaming\Typora\typora-user-images\image-20200418200843632.png)

![image-20200418201646438](C:\Users\KAUstar\AppData\Roaming\Typora\typora-user-images\image-20200418201646438.png)

하이퍼레저 시스템에 참가하는 멤버들을 관리하는 것 : MSP

합의 프로토콜을 실행하는 노드들이 있고

그런데 합의를 보기전에 먼저 피어들이 "실행"을 먼저함 이게 퍼블릭과 다른점임

퍼블릭 블록체인은 : ordering  => Execution => validation 순으로 간다면

하이퍼 레저는 : Execution => ordering => validation 순으로 간다!!!!



하여튼 endorsing 피어가 먼저 실행을 하고 그 실행 결과를 블록체인을 유지하는 모든 노드들에게 전파하는 방식으로 하고 

거래를 확정하고 블록체인 저장하는 피어는 committer라고 한다.



### 지금 금융 서비스,거래 서비스 등을 중앙 집중 시스템에서 블록체인 기반의 분산 시스템으로 만들어 보겠다!  => 인프라를 구축하는 비용을 획기적으로 낮춰보겠다



하이퍼레저를 이용하면 등록된 사용자만 쓸 수 있는~ 그런 시스템을 설계해본 것임

그래서 익명의 참가자를 포함하는 비트코인,이더리움 시스템과는 설계 자체가 다르다!!!



그렇지만 하이퍼레저 패브릭과 이더리움의 구조는 비슷하다.

![image-20200418202801024](C:\Users\KAUstar\AppData\Roaming\Typora\typora-user-images\image-20200418202801024.png)

블록에는 어떤 정보가 들어갈까? 당연히 거래정보가 들어가겠지? 

그리고 그 거래에 이더리움의 스마트 컨트랙트 같은 프로그램들(복잡한 계약을 실행하는데 필요한 프로그램 코드들이 들어가 있다라는 의미) => 하이퍼레저에서는 체인코드라고 한다.



그리고 그 chaincode를 실행한 결과가 저장이 돼야겠지? 그게 World State임(전체 상태 자료구조)

이더리움 같은 경우에는 스마트 컨트랙트를 실행한 결과가 state2에 저장이 된다네?

하이퍼레저 같은경우는 World State에 저장을 해놓음



이더리움은 상태정보를 계좌 정보를 기반으로 저장하는데...



하이퍼레저 같은 경우는 어떠한 형태를 저장하던지 간에 버전 관리를 통해서 상태정보를 관리한다.



어떤 정보가 있으면

어떤 상태정보를 찾아가는데 이때 필요한게 이름:key인데 

그리고 그 key에 대한 결과가 계속 바뀔 수 있는 거잖아? 거래를 실행함에 따라서



#### 어떤 키에 대한 값이 계속 바뀌니까 그걸 버전으로 관리하겠다